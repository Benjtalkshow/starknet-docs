pipeline {
    agent { label "gcp-hodor-slave-generic"}
    options {
       // Add timestamps to output.
       timestamps()
       timeout(time: 10, unit: 'MINUTES')
    }
    environment {
        repoOwner = "starknet-io"
        repoName = "starknet-docs"
        GITHUB_CREDENTIALS = credentials('gh-starknet-docs-pat')
    }
    stages {
        stage('Clean') {
            steps {
                script {
                    sh label:"Git config", script:
                    """
                        git config --global user.name "Starknet-Bot"
                        git config --global user.email "starknet-bot@noreply.com"
                    """
                    sh label:"Delete closed PR's folders", script:
                    """
                        CI/scripts/clean_gh_pages.sh ${GITHUB_CREDENTIALS_PSW} ${repoOwner} ${repoName}
                    """
                    sh label:"Push changes", script:
                    """
                        git pull
                        git add .
                        git commit -m "Cleaned gh-pages"
                        git push
                    """
                }
            }
        }
    }
    post {
        cleanup {
            deleteDir()
        }
    }
}

