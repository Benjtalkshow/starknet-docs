<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solidity verifier :: Starknet documentation</title>
    <link rel="canonical" href="https://docs.starknet.io/documentation/architecture_and_concepts/solidity-verifier/">
    <link rel="prev" href="../Smart_Contracts/execution_info/">
    <link rel="next" href="../Cryptography/p-value/">
    <meta name="generator" content="Antora 3.1.1">


    <!-- Primary Meta Tags -->
    <meta name="title" content="Starknet Documentation">
    <meta name="description" content="Reference documentation for developers building on Starknet.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://docs.starknet.io/">
    <meta property="og:title" content="Starknet Documentation">
    <meta property="og:description" content="Reference documentation for developers building on Starknet.">
    <meta property="og:image" content="https://www.starknet.io/starknet-docs-card.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://docs.starknet.io/">
    <meta property="twitter:title" content="Starknet Documentation">
    <meta property="twitter:description" content="Reference documentation for developers building on Starknet.">
    <meta property="twitter:image" content="https://www.starknet.io/starknet-docs-card.png">  <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
  <link id="theme" rel="stylesheet" title="Default" href="../../../_/css/site.css?new">
  <link rel="stylesheet" title="Dark" href="../../../_/css/dark-site.css?new">
  <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
  <link rel="stylesheet" href="../../../_/css/home.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WY42TERK5P"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-WY42TERK5P')</script>
    <script>var uiRootPath = '../../../_'</script>
    <script src="../../../_/js/vendor/medium-zoom.js?new"></script>
    <script type="text/javascript" id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="e4db29b5-cd94-4bcf-87e4-04f4ca564240" data-blockingmode="manual"></script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <script>
        (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3529885,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
        })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
<link rel="icon" href="../../../_/img/favicon/favicon.ico" type="image/x-icon">

<!-- For all browsers -->
<link rel="icon" type="image/png" sizes="32x32" href="../../../_/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../_/img/favicon-16x16.png">

<!-- For Google and Chrome -->
<link rel="icon" type="image/png" sizes="192x192" href="../../../_/img/favicon/android-chrome-192x192.png">

<!-- For iPad -->
<link rel="apple-touch-icon" type="image/png" sizes="167x167" href="../../../_/img/favicon/apple-touch-icon.png">
<!-- For iPhone -->
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../../_/img/favicon/apple-touch-icon.png">  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="top-logo">
        <a href="../../.." class="starknet-logo"></a>
        <div class="vertical-divider desktop-only"></div>
        <a href="../../.." class="docs-logo desktop-only">Docs</a>
      </div>
      <!--<a class="navbar-item" href="https://docs.starknet.io">Starknet documentation</a>-->
      <div id="autocomplete" class="autocomplete-root"></div>
      <div class="header-right">
        <div class="theme-toggle-container mobile-only">
          <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle"></button>
        </div>
        <button class="navbar-burger" data-target="topbar-nav">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
    
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <a class="navbar-link" href="https://starknet.io/" target="_blank">Starknet Home</a>
        </div>
        <div class="navbar-item">
          <a class="navbar-link" href="https://starknet.io/building-on-starknet/tutorials/" target="_blank">Tutorials</a>
        </div>
        <div class="theme-toggle-container">
          <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle navbar-item"></button>
        </div>
      </div>
    </div>
  </nav>
</header><div class="toolbar" role="navigation">
  <div class="components-versions desktop-only">
  </div>
  <span></span>
  <span></span>
  <a href="../../" class="home-link mask-svg-center"></a>
  <div id="mobile-autocomplete" class="mobile-only"></div>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Starknet</a></li>
    <li>Architecture</li>
    <li><a href="./">Solidity verifier</a></li>
  </ul>
</nav>
  <div class="edit-this-page">
    <a href="https://github.com/starknet-io/starknet-docs/edit/main/components/Starknet/modules/architecture_and_concepts/pages/solidity-verifier.adoc"><img class="pencil">Edit this Page</a>
  </div>
</div>
<div class="background">
<div class="top-announcement-bar d-flex">
  <p class="announcement-bar-title body-xsmall-strong">Starknet Annual Developer Survey</p>
  <a class="announcement-bar-cta body-xsmall-strong" href="https://forms.reform.app/starkware/starknet-developer-survey" target="_blank"> Make yourself heard </a>
<!--
  <button class="top-ann-bar-close">
    <svg width="10" height="10" viewBox="0 0 10 10" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
      <path d="M1.28033 0.219792C0.987437 -0.0731012 0.512563 -0.0731012 0.21967 0.219792C-0.0732233 0.512685 -0.0732233 0.987559 0.21967 1.28045L3.93934 5.00012L0.21967 8.71979C-0.0732233 9.01268 -0.0732233 9.48756 0.21967 9.78045C0.512563 10.0733 0.987437 10.0733 1.28033 9.78045L5 6.06078L8.71967 9.78045C9.01256 10.0733 9.48744 10.0733 9.78033 9.78045C10.0732 9.48756 10.0732 9.01268 9.78033 8.71979L6.06066 5.00012L9.78033 1.28045C10.0732 0.987559 10.0732 0.512685 9.78033 0.219792C9.48744 -0.0731012 9.01256 -0.0731012 8.71967 0.219792L5 3.93946L1.28033 0.219792Z" fill="currentColor"/>
    </svg>
  </button>
-->
</div>
</div>
<div class="body">
<div class="nav-container" data-component="documentation" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../">Starknet</a></h3>
<ul class="nav-list">
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a 
       class="nav-link"
     href="../../">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a 
       class="nav-link"
     href="../../notational-conventions/">Notational conventions</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Quick start</span>
<ul class="nav-list">
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
        <span>
    <a 
       class="nav-link nav-link-with-toggle"
     href="../../quick_start/environment_setup/">Setting up your environment</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../quick_start/environment_setup/#installing_starkli">Installing Starkli</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../quick_start/environment_setup/#setting_environment_variables_for_starkli">Environment variables</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../quick_start/environment_setup/#installing_scarb">Installing Scarb</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
        <span>
    <a 
       class="nav-link nav-link-with-toggle"
     href="../../quick_start/set_up_an_account/">Setting up an account</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../quick_start/set_up_an_account/#creating_an_account">Creating an account</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../quick_start/set_up_an_account/#deploying_an_account">Deploying an account</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../quick_start/declare_a_smart_contract/">Declaring a smart contract</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../quick_start/deploy_a_smart_contract/">Deploying a smart contract</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../quick_start/interact_with_a_smart_contract/">Interacting with a smart contract</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Release information</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../starknet_versions/version_notes/">Release notes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../starknet_versions/deprecated/">Deprecated, unsupported, and removed features</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../Network_Architecture/starknet_architecture_overview/">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../Network_Architecture/header/">Block structure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../Network_Architecture/transaction-life-cycle/">Transaction lifecycle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../Network_Architecture/transactions/">Transaction types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../Network_Architecture/fee-mechanism/">Gas and transaction fees</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">State</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Network_Architecture/starknet-state/">Starknet state</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Network_Architecture/on-chain-data/">Data availability</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../Network_Architecture/messaging-mechanism/">L1-L2 messaging</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Accounts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Accounts/introduction/">What is an account?</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Accounts/approach/">Starknet&#8217;s account interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Accounts/account_functions/">Account interface function reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Accounts/deploying_new_accounts/">Deploying new accounts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Accounts/universal-deployer/">Universal Deployer Contract</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Accounts/simplified_transaction_flow/">Simplified transaction flow</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Contracts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/contract-classes/">Contract classes and instances</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/class-hash/">Class hash</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/contract-address/">Contract address</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/contract-storage/">Contract storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/contract-abi/">Contract ABI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/starknet-events/">Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/contract-syntax/">Migrating a contract from Cairo v1 to Cairo v2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/cairo-and-sierra/">Cairo and Sierra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/cairo-builtins/">Cairo builtins</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/serialization_of_Cairo_types/">Serialization of Cairo types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/system-calls-cairo1/">System calls</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Smart_Contracts/execution_info/">Execution information for the current block</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a 
       class="nav-link"
     href="./">Solidity verifier</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Cryptography</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Cryptography/p-value/">The STARK field</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Cryptography/stark-curve/">The STARK curve</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../Cryptography/hash-functions/">Hash functions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a 
       class="nav-link"
     href="../Economics-of-Starknet/">The Economics of Starknet</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Developer tools and resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/starknet-book/">The Starknet Book</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/devtools/">Developer tools</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Cairo 0 tools</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../cli/starkli/">Legacy Starknet CLI reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../cli/starknet-compiler-options/">Legacy compiler CLI reference</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Full nodes and API services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../tools/api-services/">Full nodes and API services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../starknet_versions/juno_versions/">Juno release notes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../starknet_versions/pathfinder_versions/">Pathfinder release notes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/ref_block_explorers/">Block explorers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/audit/">Audit providers</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">StarkGate bridge guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/starkgate-bridge/">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/starkgate_architecture/">StarkGate architecture</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Procedures</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../tools/starkgate-depositing/">Depositing funds</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../tools/starkgate-withdrawing/">Withdrawing funds</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../tools/starkgate-automated_actions_with_bridging/">Performing a Smart Deposit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../tools/starkgate-adding_a_token/">Adding a token</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../tools/starkgate-cancelling%20a%20deposit/">Cancelling a deposit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../tools/starkgate-estimating_fees/">Estimating StarkGate fees</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a 
       class="nav-link"
     href="../../tools/dai_token_migration/">Migrating DAI v0 to DAI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/starkgate_function_reference/">StarkGate function and event reference</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle mask-svg-center"></button>
    <span class="nav-text">Important addresses</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/important_addresses/">Starknet contracts and sequencer addresses</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a 
       class="nav-link"
     href="../../tools/bridged_tokens/">Bridged tokens</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a 
       class="nav-link"
     href="../../tools/limits_and_triggers/">Current limits</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a 
       class="nav-link"
     href="../../glossary/">Glossary</a>
  </li>
</ul>
  </li>
</ul>
    <div class="navbar-end mobile-only">
      <div class="hr-divider"></div>
      <div class="navbar-item-flex">
        <a class="navbar-link" href="https://starknet.io/" target="_blank">Starknet Home</a>
        <a class="link-icon" href="https://starknet.io/" target="_blank"></a>
      </div>
      <div class="navbar-item-flex">
        <a class="navbar-link" href="https://starknet.io/building-on-starknet/tutorials/" target="_blank">Tutorials</a>
        <a class="link-icon" href="https://starknet.io/building-on-starknet/tutorials/" target="_blank"></a>
      </div>
    </div>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Solidity verifier</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This topic previously appeared in the Starknet Book.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before exploring this topic, review the <a href="../Network_Architecture/starknet_architecture_overview/" class="xref page">Starknet architecture: Overview</a> for foundational knowledge. Familiarity with concepts such as sequencers, provers, SHARP, and SHARP jobs is assumed.</p>
</div>
<div class="paragraph">
<p>Starknet&#8217;s Solidity verifier plays a pivotal role in the rollup landscape, ensuring the truth of transactions and smart contracts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quick_review_sharp_and_sharp_jobs"><a class="anchor" href="#quick_review_sharp_and_sharp_jobs"></a>Quick review: SHARP and SHARP jobs</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a more detailed explanation of SHARP and SHARP jobs, see <a href="#architecture_and_concepts:provers-overview.adoc" class="xref unresolved">Provers</a>. This is a brief review.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Starknet, the Shared Prover, SHARP, aggregates various Cairo programs from distinct users. These programs, each with unique logic, run together, producing a common proof for all, optimizing cost and efficiency.</p>
</div>
<div class="paragraph">
<div class="title">SHARP Workflow</div>
<p><span class="image"><img src="../_images/shared-prover.png" alt="SHARP workflow"></span></p>
</div>
<div class="paragraph">
<p>Furthermore, SHARP supports combining multiple proofs into one, enhancing its efficiency by allowing parallel proof processing and verification.</p>
</div>
<div class="paragraph">
<p>SHARP verifies numerous Starknet transactions, like transfers, trades, and state updates. It also confirms smart contract executions.</p>
</div>
<div class="paragraph">
<p>To illustrate SHARP: Think of commuting by bus. The bus driver, the prover, transports passengers, the Cairo programs. The driver checks only the tickets of passengers alighting at the upcoming stop, much like SHARP. The prover forms a single proof for all Cairo programs in a batch, but verifies only the proofs of programs executing in the succeeding block.</p>
</div>
<div class="paragraph">
<p><strong>SHARP jobs</strong> enable multiple users to present their Cairo programs for combined execution, distributing the proof generation cost. This shared approach makes Starknet more economical for users, enabling them to join ongoing jobs and leverage economies of scale.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solidity_verifiers"><a class="anchor" href="#solidity_verifiers"></a>Solidity verifiers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Solidity verifier is an L1 smart contract, crafted in Solidity, designed to validate STARK proofs from SHARP.</p>
</div>
<div class="sect2">
<h3 id="previous_architecture_monolithic_verifier"><a class="anchor" href="#previous_architecture_monolithic_verifier"></a>Previous architecture: Monolithic verifier</h3>
<div class="paragraph">
<p>Historically, the Solidity verifier was a monolithic contract, both initiated and executed by the same contract. For illustration, the operator would invoke the <code>update state</code> function on the main contract, providing the state to be modified and confirming its validity. Subsequently, the main contract would present the proof to both the verifier and the data availability committee. Once they validated the proof, the state would be updated in the main contract.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/prehistoric-architecture.png" alt="Previous architecture">
</div>
<div class="title">Figure 1. Previous architecture</div>
</div>
<div class="paragraph">
<p>However, this architecture faced several constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Batching transactions frequently surpassed the original Geth 32 KB transaction size limit, later adjusted to 128 KB, due to accumulating excessive transactions.</p>
</li>
<li>
<p>The gas required often outstripped the block size (e.g., 8 Mgas), as the block couldn&#8217;t accommodate a complete batch of proof.</p>
</li>
<li>
<p>A prospective constraint was that the verifier wouldn&#8217;t support proof bundling, which is fundamental for SHARP.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="current_architecture_multiple_smart_contracts"><a class="anchor" href="#current_architecture_multiple_smart_contracts"></a>Current architecture: Multiple smart contracts</h3>
<div class="paragraph">
<p>The current verifier uses multiple smart contracts rather than being a singular, monolithic structure.</p>
</div>
<div class="paragraph">
<p>Here are some key smart contracts associated with the verifier:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://etherscan.io/address/0x47312450b3ac8b5b8e247a6bb6d523e7605bdb60"><code>GpsStatementVerifier</code></a>: This is the primary contract of the SHARP verifier. It verifies a proof and then registers the related facts using <code>verifyProofAndRegister</code>. It acts as an umbrella for various layouts, each named <code>CpuFrilessVerifier</code>. Every layout has a unique combination of built-in resources.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/verifier-layouts.png" alt="Verifier layouts">
</div>
<div class="title">Figure 2. Verifier layouts</div>
</div>
<div class="paragraph">
<p>The system routes each proof to its relevant layout.</p>
</div>
</li>
<li>
<p><a href="https://etherscan.io/address/0xfd14567eaf9ba941cb8c8a94eec14831ca7fd1b4"><code>MemoryPageFactRegistry</code></a>: This registry maintains facts for memory pages, primarily used to register outputs for data availability in rollup mode. The Fact Registry is a separate smart contract ensuring the verification and validity of attestations or facts. The verifier function is separated from the main contract to ensure each segment works optimally within its limits. The main proof segment relies on other parts, but these parts operate independently.</p>
</li>
<li>
<p><a href="https://etherscan.io/address/0x5899efea757e0dbd6d114b3375c23d7540f65fa4"><code>MerkleStatementContract</code></a>: This contract verifies Merkle paths.</p>
</li>
<li>
<p><a href="https://etherscan.io/address/0x3e6118da317f7a433031f03bb71ab870d87dd2dd"><code>FriStatementContract</code></a>: It focuses on verifying the FRI layers.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sharp_verifier_contract_map"><a class="anchor" href="#sharp_verifier_contract_map"></a>SHARP verifier contract map</h3>
<div class="paragraph">
<p>The SHARP verifier contract map contains roughly 40 contracts, detailing various components of the Solidity verifier. The images below display the contracts and their Ethereum Mainnet addresses.</p>
</div>
<div class="paragraph">
<div class="title">SHARP verifier contract map</div>
<p>These are currently the entire stack of contracts that comprise the SHARP verifier, with their Ethereum Mainnet addresses.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Proxy
</td>
<td class="hdlist2">
<p>0x47312450B3Ac8b5b8e247a6bB6d523e7605bDb60</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CallProxy
</td>
<td class="hdlist2">
<p>0xD4C4044ACa68ebBcB81B13cC2699e1Bca2d3F458</p>
</td>
</tr>
<tr>
<td class="hdlist1">
GpsStatementVerifier
</td>
<td class="hdlist2">
<p>0x47312450b3ac8b5b8e247a6bb6d523e7605bdb60</p>
</td>
</tr>
<tr>
<td class="hdlist1">
MemoryPageFactRegistry
</td>
<td class="hdlist2">
<p>0xfd14567eaf9ba941cb8c8a94eec14831ca7fd1b4</p>
</td>
</tr>
<tr>
<td class="hdlist1">
MerkleStatementContract
</td>
<td class="hdlist2">
<p>0x3e6118da317f7a433031f03bb71ab870d87dd2dd</p>
</td>
</tr>
<tr>
<td class="hdlist1">
FriStatementContract
</td>
<td class="hdlist2">
<p>0x3e6118da317f7a433031f03bb71ab870d87dd2dd</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CairoBootloaderProgram
</td>
<td class="hdlist2">
<p>0x5d07afFAfc8721Ef3dEe4D11A2D1484CBf6A9dDf</p>
</td>
</tr>
<tr>
<td class="hdlist1">
PedersenHashPointsXColumn
</td>
<td class="hdlist2">
<p>0xc4f21318937017B8aBe5fDc0D48f58dBc1d18940</p>
</td>
</tr>
<tr>
<td class="hdlist1">
PedersenHashPointsYColumn
</td>
<td class="hdlist2">
<p>0x519DA5F74503dA351EbBED889111377d33096002</p>
</td>
</tr>
<tr>
<td class="hdlist1">
EcdsaHashPointsXColumn
<br>
EcdsaHashPointsYColumn
</td>
<td class="hdlist2">
<p>0xcA59f6FD499ffF50c78Ffb420a9bcd0d273abf29</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CpuFrilessVerifier0
<br>
CpuOods0
<br>
CpuConstraintPoly0
<br>
CpuFrilessVerifier1
<br>
CpuOods1
<br>
CpuConstraintPoly1
<br>
CpuFrilessVerifier2
<br>
CpuOods2
<br>
CpuConstraintPoly2
<br>
CpuFrilessVerifier3
<br>
CpuOods3
<br>
CpuConstraintPoly3
<br>
CpuFrilessVerifier4
<br>
CpuOods4
<br>
CpuConstraintPoly4
<br>
CpuFrilessVerifier5
<br>
CpuOods5
<br>
CpuConstraintPoly5
<br>
CpuFrilessVerifier6
<br>
CpuOods6
<br>
CpuConstraintPoly6
<br>
PoseidonPoseidonFullRoundKey0Column6
<br>
PoseidonPoseidonFullRoundKey1Column6
<br>
PoseidonPoseidonFullRoundKey2Column6
<br>
PoseidonPoseidonPartialRoundKey0Column6
<br>
ם9999999999999999999ן
<br>
CpuFrilessVerifier7
<br>
CpuOods7
<br>
CpuConstraintPoly7
</td>
<td class="hdlist2">
<p>.SHARP verifier contract map
image::sharp-contract-map-1.png[SHARP verifier contract map]</p>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/sharp-contract-map-2.png" alt="SHARP verifier contract map">
</div>
<div class="title">Figure 3. SHARP verifier contract map (continued)</div>
</div>
<div class="paragraph">
<p>These contracts function as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Proxy</strong>: This contract facilitates upgradability. It interacts with the <code>GpsStatementVerifier</code> contract using the <code>delegate_call</code> method. Notably, the state resides in the <code>GpsStatementVerifier</code> contract, not in the proxy.</p>
</li>
<li>
<p><strong>CallProxy</strong>: Positioned between the <code>Proxy</code> and the <code>GpsStatementVerifier</code> contracts, it functions like a typical proxy. However, it avoids the <code>delegate_call</code> method and calls the function in the implementation contract directly.</p>
</li>
<li>
<p><strong>CairoBootloaderProgram</strong>: Comprising numerical Cairo programs, it validates the Cairo program of a statement. The bootloader manages the logic executing Cairo programs to generate proof and program hash.</p>
</li>
<li>
<p><strong>PedersenHashPoints (X &amp; Y Column)</strong>: These lookup tables store vast amounts of data. Validation functions consult them to compute the Pedersen hash.</p>
</li>
<li>
<p><strong>EcdsaPoints (X &amp; Y Column)</strong>: Similar to the Pedersen hash, these tables assist in calculating the elliptic curve.</p>
</li>
<li>
<p><strong>CpuFrilessVerifier/CpuOods/CpuConstantPoly (0 - 7)</strong>: These verifier contracts vary in layout as shown in the <code>GpsStatementVerifier</code> layout image. Each layout encompasses resources, built-ins, constraints, and more, designed for a specific task. Each has unique parameters for its constructor.</p>
</li>
<li>
<p><strong>PoseidonPoseidon</strong>: These contracts back the new Poseidon built-in and contain Poseidon-specific lookup tables.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="constructor_parameters_of_key_contracts"><a class="anchor" href="#constructor_parameters_of_key_contracts"></a>Constructor parameters of key contracts</h3>
<div class="paragraph">
<p>When constructing the primary verifier contracts, specific parameters are employed to facilitate functionality. These parameters reference other auxiliary contracts, decentralizing the logic and ensuring the main contract remains under the 24kb deployment limit.</p>
</div>
<div class="paragraph">
<p>Below is a visual representation of these parameters in relation to key contracts <code>CpuFrilessVerifiers</code> and <code>GpsStatementVerifier</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/constructor-params.png" alt="Constructor Parameters">
</div>
<div class="title">Figure 4. Constructor Parameters</div>
</div>
<div class="sect3">
<h4 id="cpufrilessverifier_constructor_parameters"><a class="anchor" href="#cpufrilessverifier_constructor_parameters"></a>CpuFrilessVerifier constructor parameters</h4>
<div class="paragraph">
<p><code>CpuFrilessVerifiers</code> is designed to handle a diverse range of tasks. Its parameters encompass:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Auxiliary Polynomial Contracts:</strong> These include <code>CpuConstraintPoly</code>, <code>PedersenHashPointsxColumn</code>, <code>PedersenHashPointsYColumn</code>, <code>EcdsaPointsXColumn</code>, and <code>EcdsaPointsYColumn</code>.</p>
</li>
<li>
<p><strong>Poseidon-Related Contracts:</strong> Several <code>PoseidonPoseidonFullRoundKey</code> and <code>PoseidonPoseidonPartialRoundKey</code> contracts.</p>
</li>
<li>
<p><strong>Sampling and Memory:</strong> The contract uses <code>CpuOods</code> for out-of-domain sampling and <code>MemoryPageFactRegistry</code> for memory-related tasks.</p>
</li>
<li>
<p><strong>Verification:</strong> It integrates with <code>MerkleStatementContract</code> for Merkle verification and <code>FriStatementContract</code> for Fri-related tasks.</p>
</li>
<li>
<p><strong>Security:</strong> The <code>num_security_bits</code> and <code>min_proof_of_work_bits</code> contracts ensure secure operation.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For instances like <code>CpuFrilessVerifier0</code>, specific contracts (e.g., <code>CpuConstraintPoly0</code>, <code>PoseidonPoseidonFullRoundKeyColumn0</code>, <code>CpuOods0</code>) become particularly relevant.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="gpsstatementverifier_constructor_parameters"><a class="anchor" href="#gpsstatementverifier_constructor_parameters"></a>GpsStatementVerifier constructor parameters</h4>
<div class="paragraph">
<p>The <code>GpsStatementVerifier</code> functions as the hub of verifier operations, necessitating various parameters for effective functioning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Bootloader:</strong> It references the <code>CairoBootloaderProgram</code> to initiate the system.</p>
</li>
<li>
<p><strong>Memory Operations:</strong> This is facilitated by the <code>MemoryPageFactRegistry</code> contract.</p>
</li>
<li>
<p><strong>Sub-Verifiers:</strong> It integrates a series of sub-verifiers (<code>CpuFrilessVerifier0</code> through <code>CpuFrilessVerifier7</code>) to decentralize tasks.</p>
</li>
<li>
<p><strong>Verification:</strong> The hashes, <code>hashed_supported_cairo_verifiers</code> and <code>simple_bootloader_program_hash</code>, are essential for validation processes.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="interconnection_of_contracts"><a class="anchor" href="#interconnection_of_contracts"></a>Interconnection of contracts</h3>
<div class="paragraph">
<p>The <code>GpsStatementVerifier</code> serves as the primary verifier contract, optimized for minimal logic to fit within deployment size constraints. To function effectively:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It relies on smaller verifier contracts, which are already deployed and contain varied verification logic.</p>
</li>
<li>
<p>These smaller contracts, in turn, depend on other contracts, established during their construction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In essence, while the diverse functionalities reside in separate contracts for clarity and size efficiency, they are all interlinked within the <code>GpsStatementVerifier</code>.</p>
</div>
<div class="paragraph">
<p>For future enhancements or adjustments, the proxy and callproxy contracts facilitate upgradability, allowing seamless updates to the <code>GpsStatementVerifier</code> without compromising its foundational logic.</p>
</div>
</div>
<div class="sect2">
<h3 id="sharp_verification_flow"><a class="anchor" href="#sharp_verification_flow"></a>SHARP verification flow</h3>
<div class="imageblock">
<div class="content">
<img src="../_images/new-sharp-flow.png" alt="SHARP verification flow">
</div>
<div class="title">Figure 5. SHARP Verification Flow</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The SHARP dispatcher transmits all essential transactions for verification, including: a. <code>MemoryPages</code> (usually many). b. <code>MerkleStatements</code> (typically between 3 and 5). c. <code>FriStatements</code> (generally ranging from 5 to 15).</p>
</li>
<li>
<p>The SHARP dispatcher then forwards the proof using <code>verifyProofAndRegister</code>.</p>
</li>
<li>
<p>Applications, such as the Starknet monitor, validate the status. Once verification completes, they send an <code>updateState</code> transaction.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starknet transformed the Solidity verifier from a single unit to a flexible, multi-contract system, highlighting its focus on scalability and efficiency. Using SHARP and refining verification steps, Starknet makes sure the Solidity verifier stays a strong cornerstone in its setup.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../Smart_Contracts/execution_info/">Execution information for the current block</a></span>
  <span class="next"><a href="../Cryptography/p-value/">The STARK field</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footerdiv">
    <div class="footer-left">
      <p>Built with ✨ by the Starknet community</p>
    </div>
    <div class="footer-network-info"><strong>Mainnet: 0.13.1.1 | Sepolia: 0.13.1.1</strong>
</div>
    <!-- <div class="community-section">
      <p class="community-section__text">Follow Lisk on: </p>
      <div class="community-section__icons"> -->
    <div class="community_icons">
        <a href="https://twitter.com/@Starknet" title="Twitter" target="_blank" class="footer_icon">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" font-size="1.25rem" aria-hidden="true" focusable="false" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg>
          <p>Twitter</p>
        </a>
        <a href="https://starknet.io/discord" title="Discord" target="_blank" class="footer_icon">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" font-size="1.25rem" aria-hidden="true" focusable="false" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"></path></svg>
          <p>Discord</p>
        </a>
        <a href="https://github.com/starknet-io/starknet-docs" title="GitHub" target="_blank" class="footer_icon">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" font-size="1.25rem" aria-hidden="true" focusable="false" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
          <p>GitHub</p>
        </a>
  <!--    </div> -->
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js?new"></script>
<script async src="../../../_/js/vendor/highlight.js?new"></script>
<script async src="../../../_/js/vendor/tabs-block-behaviour.js?new"></script>
<script async src="../../../_/js/vendor/swagger-ui.js?new"></script>
<script async src="../../../_/js/vendor/component-versions.js?new"></script>
<script src="../../../_/js/vendor/custom.js?new"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-js"></script>
<script
    src="https://cdn.jsdelivr.net/npm/algoliasearch@4.14.3/dist/algoliasearch-lite.umd.js"
    integrity="sha256-dyJcbGuYfdzNfifkHxYVd/rzeR6SLLcDFYEidcybldM="
    crossorigin="anonymous"
></script>
<script src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-plugin-recent-searches"></script>
<script src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-plugin-query-suggestions"></script>

<script>
  const { createQuerySuggestionsPlugin } = window['@algolia/autocomplete-plugin-query-suggestions'];
  const { createLocalStorageRecentSearchesPlugin, search } = window['@algolia/autocomplete-plugin-recent-searches'];
  const { algoliasearch } = window;
  const { autocomplete, getAlgoliaResults, getAlgoliaFacets} = window["@algolia/autocomplete-js"]
</script>

<script>
  function createLocalStorageRecentlyViewedItems(params) {
      const {
        onReset,
        onSubmit,
        subscribe,
        ...plugin
      } = createLocalStorageRecentSearchesPlugin({
        ...params,
        search(params) {
          if (params.query) {
            return [];
          }

          return search(params);
        },
        transformSource({ source, onRemove, state }) {
          const transformedSource = params.transformSource
            ? params.transformSource({ source, onRemove, state })
            : source;

          return {
            ...transformedSource,
            getItemUrl({ item }) {
              return item.url;
            },
            templates: {
              ...transformedSource.templates,
              header({html}) {
                return (html`
                  <div>
                    <span class="aa-SourceHeaderTitle">Recently viewed</span>
                  </div>
                `);
              },
              item({ item, components, html }) {

               const removeRecentItem = (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    onRemove(item.id);
                }

                return (html`
                  <a class="aa-ItemLink" href=${item.url}>
                    <div class="aa-ItemContent">
                      <div class="aa-ItemIcon aa-ItemIcon--noBorder">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12.516 6.984v5.25l4.5 2.672-0.75 1.266-5.25-3.188v-6h1.5zM12 20.016q3.281 0 5.648-2.367t2.367-5.648-2.367-5.648-5.648-2.367-5.648 2.367-2.367 5.648 2.367 5.648 5.648 2.367zM12 2.016q4.125 0 7.055 2.93t2.93 7.055-2.93 7.055-7.055 2.93-7.055-2.93-2.93-7.055 2.93-7.055 7.055-2.93z" />
                        </svg>
                      </div>
                      <div class="aa-ItemContentBody">
                        <div class="aa-ItemContentTitle">
                          ${components.Highlight({ attribute: 'title', hit: item })}
                        </div>
                      </div>
                    </div>
                    <div class="aa-ItemActions">
                      <button
                        class="aa-ItemActionButton aa-ItemActionButtonDanger"
                        title="Remove this search"
                        onclick=${event => removeRecentItem(event)}
                      >
                        <svg
                          viewBox="0 0 24 24"
                          width="18"
                          height="18"
                          fill="currentColor"
                        >
                          <path d="M18 7v13c0 0.276-0.111 0.525-0.293 0.707s-0.431 0.293-0.707 0.293h-10c-0.276 0-0.525-0.111-0.707-0.293s-0.293-0.431-0.293-0.707v-13zM17 5v-1c0-0.828-0.337-1.58-0.879-2.121s-1.293-0.879-2.121-0.879h-4c-0.828 0-1.58 0.337-2.121 0.879s-0.879 1.293-0.879 2.121v1h-4c-0.552 0-1 0.448-1 1s0.448 1 1 1h1v13c0 0.828 0.337 1.58 0.879 2.121s1.293 0.879 2.121 0.879h10c0.828 0 1.58-0.337 2.121-0.879s0.879-1.293 0.879-2.121v-13h1c0.552 0 1-0.448 1-1s-0.448-1-1-1zM9 5v-1c0-0.276 0.111-0.525 0.293-0.707s0.431-0.293 0.707-0.293h4c0.276 0 0.525 0.111 0.707 0.293s0.293 0.431 0.293 0.707v1zM9 11v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1zM13 11v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1z" />
                        </svg>
                      </button>
                    </div>
                  </a>
                `);
              }
            }
          };
        }
      });

      const { getAlgoliaSearchParams, ...data } = plugin.data;

      return {
        ...plugin,
        data
      };
    }
</script>

<script>
  function createMostPopularSearchesPlugin(){
    const popularSearchers = createQuerySuggestionsPlugin({
      searchClient,
      indexName: 'web_query_suggestions_dev',
      getSearchParams({ state }) {
        return { hitsPerPage: 3 };
      },
      transformSource({ source, onTapAhead }) {
        const onSelectSuggestion = (event, item) => {
          event.preventDefault();
          event.stopPropagation();
          onTapAhead(item)
        };

        return {
          ...source,
          templates: {
            ...source.templates,
            header({ state, html }) {
              if (state.query) {
                return null;
              }

              return (html`
                <div>
                  <span className="aa-SourceHeaderTitle">Popular searches</span>
                </div>
              `);
            },
            item({html, item}){


              return (html`
                <div class="aa-ItemWrapper" onclick=${event => onSelectSuggestion(event, item)}>
                  <div class="aa-ItemContent">
                    <div class="aa-ItemIcon aa-ItemIcon--noBorder">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                          <path d="M16.041 15.856c-0.034 0.026-0.067 0.055-0.099 0.087s-0.060 0.064-0.087 0.099c-1.258 1.213-2.969 1.958-4.855 1.958-1.933 0-3.682-0.782-4.95-2.050s-2.050-3.017-2.050-4.95 0.782-3.682 2.050-4.95 3.017-2.050 4.95-2.050 3.682 0.782 4.95 2.050 2.050 3.017 2.050 4.95c0 1.886-0.745 3.597-1.959 4.856zM21.707 20.293l-3.675-3.675c1.231-1.54 1.968-3.493 1.968-5.618 0-2.485-1.008-4.736-2.636-6.364s-3.879-2.636-6.364-2.636-4.736 1.008-6.364 2.636-2.636 3.879-2.636 6.364 1.008 4.736 2.636 6.364 3.879 2.636 6.364 2.636c2.125 0 4.078-0.737 5.618-1.968l3.675 3.675c0.391 0.391 1.024 0.391 1.414 0s0.391-1.024 0-1.414z"></path>
                        </svg>
                    </div>
                    <div class="aa-ItemContentBody">
                        <div class="aa-ItemContentTitle">${item.query}</div>
                    </div>
                  </div>
                  <div class="aa-ItemActions">
                    <button class="aa-ItemActionButton" title=${`Fill query with "${item.query}"`}>
                        <svg viewBox="0 0 24 24" fill="currentColor">
                          <path d="M8 17v-7.586l8.293 8.293c0.391 0.391 1.024 0.391 1.414 0s0.391-1.024 0-1.414l-8.293-8.293h7.586c0.552 0 1-0.448 1-1s-0.448-1-1-1h-10c-0.552 0-1 0.448-1 1v10c0 0.552 0.448 1 1 1s1-0.448 1-1z"></path>
                        </svg>
                    </button>
                  </div>
                </div>
              `)
            }
          },
          onSelect({event, item, setIsOpen, itemInputValue, setQuery, refresh, ...rest}) {
            setIsOpen(true);
          },
        };
      },
    })

    return popularSearchers
  }
</script>

<script>
    const appId = "VHYJO45TI4";
    const apiKey = "9d5f273e78238a8c505526e481c857f7";
    const searchClient = algoliasearch(appId, apiKey);
    const hitsPerPage = 20

    function getSources({ query, state }) {
        if (!query) {
          return [];
        }

        return [
          {
            sourceId: "docs",
            getItems() {
              return getAlgoliaResults({
                searchClient,
                queries: [
                  {
                    indexName: "starknet-docs-main",
                    query,
                    params: {
                      attributesToSnippet: ["title:8", "content:10"],
                      snippetEllipsisText: "…",
                      hitsPerPage,
                    }
                  }
                ]
              });
            },
            getItemUrl({ item }) {
              return `${item.url}`;
            },
            onSelect({ item }) {
              recentlyViewedItems.data.addItem({
                id: item.objectID,
                title: item.title || item.content,
                url: item.url
              });
            },
            templates: {
              header({html, items}) {
                if(items.length === 0){
                  return null
                }
                return (
                  html`<span class="aa-SourceHeaderTitle">Documentation</span>`
                );
              },
              item({ item: hit, components, html}) {
                return (html`
                    <a href=${hit.url} class="aa-ItemLink">
                      <div class="aa-ItemContent">
                        <div class="aa-ItemIcon aa-ItemIcon--noBorder">
                          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M19.5999 9.99999C19.5999 15.3019 15.3018 19.6 9.9999 19.6C4.69797 19.6 0.399902 15.3019 0.399902 9.99999C0.399902 4.69806 4.69797 0.399994 9.9999 0.399994C15.3018 0.399994 19.5999 4.69806 19.5999 9.99999ZM17.7961 10.2449C17.6667 14.4394 14.2258 17.8 9.9999 17.8C5.69208 17.8 2.1999 14.3078 2.1999 9.99999C2.1999 6.55187 4.43732 3.62632 7.53954 2.59597L6.31196 4.74422C5.92196 5.42673 6.03701 6.28582 6.59284 6.84165C7.12339 7.37219 7.9339 7.50372 8.60499 7.16818L8.81467 7.06334C8.89798 7.02168 8.98985 6.99999 9.083 6.99999H9.25807C9.48534 6.99999 9.69309 7.1284 9.79473 7.33167C9.87919 7.50058 9.87919 7.69941 9.79473 7.86832L9.76138 7.93502C9.68018 8.09741 9.51421 8.19999 9.33265 8.19999H8.73006C7.82327 8.19999 6.97648 8.65319 6.47348 9.40768L6.42091 9.48654C5.98984 10.1331 5.88144 10.9426 6.12719 11.6798C6.37831 12.4331 6.97335 13.0237 7.72395 13.2739C8.00786 13.3685 8.19971 13.635 8.19971 13.9298V15.1895C8.19971 15.9685 8.8312 16.6 9.61018 16.6C10.0387 16.6 10.4439 16.4052 10.7116 16.0706L12.6452 13.6536C12.8747 13.3667 12.9997 13.0103 12.9997 12.643C12.9997 12.2639 13.1533 11.8949 13.4236 11.6246C13.9704 11.0778 14.0636 10.2141 13.6307 9.56485L13.074 8.72974C13.0256 8.65709 12.9997 8.57174 12.9997 8.48444C12.9997 8.12003 13.4157 7.91201 13.7073 8.13066L14.1185 8.4391C14.4975 8.7233 15.0044 8.76847 15.4274 8.55695C15.6984 8.42147 16.0258 8.47464 16.2395 8.68826L17.7961 10.2449Z" fill="currentColor"/>
                          </svg>
                        </div>
                        <div class="aa-ItemContentBody">
                          <div class="aa-ItemContentTitle">
                            ${components.Highlight({ attribute: 'value', hit: hit['_snippetResult'].content })}
                          </div>
                          <div class="aa-ItemContentSubtitle">
                            ${components.Highlight({ attribute: 'value', hit: hit['_snippetResult'].title })}
                          </div>
                        </div>
                      </div>
                      <div class="aa-ItemActions">
                        <button
                          class="aa-ItemActionButton"
                          title="Visit this link"
                        >
                          <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.35103 3.1786C9.69424 3.53815 9.68099 4.10784 9.32144 4.45105L4.34632 9.20003H16.35C19.9122 9.20003 22.8 12.0878 22.8 15.65C22.8 19.2123 19.9122 22.1 16.35 22.1H12.9C12.403 22.1 12 21.6971 12 21.2C12 20.703 12.403 20.3 12.9 20.3H16.35C18.9181 20.3 21 18.2182 21 15.65C21 13.0819 18.9181 11 16.35 11H4.34632L9.32144 15.749C9.68099 16.0922 9.69424 16.6619 9.35103 17.0215C9.00783 17.381 8.43813 17.3943 8.07858 17.051L1.47858 10.751C1.30067 10.5812 1.20001 10.346 1.20001 10.1C1.20001 9.85407 1.30067 9.61883 1.47858 9.44901L8.07858 3.14901C8.43813 2.8058 9.00783 2.81905 9.35103 3.1786Z" fill="currentColor"/>
                          </svg>
                        </button>
                      </div>
                    </a>
                  `)
              },
              noResults({state, html}) {
                return (html`
                  No results for <bold>"${state.query}"</bold> 😕
                `);
              }
            }
          }
        ];
    };

    const recentlyViewedItems = createLocalStorageRecentlyViewedItems({
      key: "RECENTLY_VIEWED",
      limit: 5
    });

    const mostPopulerSearches = createMostPopularSearchesPlugin()

    autocomplete({
      container: "#autocomplete",
      placeholder: "Search",
      openOnFocus: true,
      detachedMediaQuery: "",
      getSources,
      plugins: [recentlyViewedItems, mostPopulerSearches],
    });
</script>

<script>
  const modalBreakpoint = 680;
  const modalClassname = 'aa-DetachedContainer--modal'

  function toggleAlgoliaModal(){
      const algoliaDetachedContainer = document.querySelector('.aa-DetachedContainer')
      if(!algoliaDetachedContainer){
        return
      }
      const documentWidth = document.documentElement.clientWidth;
      if(documentWidth >= modalBreakpoint){
        algoliaDetachedContainer.classList.add(modalClassname)
      }else {
        algoliaDetachedContainer.classList.remove(modalClassname)
      }
  }

  // Attaching the event listener function to window's resize event
  window.addEventListener("resize", toggleAlgoliaModal);

  // Calling the function for the first time
  toggleAlgoliaModal();

</script>
  </body>
</html>
